<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>衣服訂購表單</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h1, h2 {
            color: #333;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background-color: #45a049;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        .order-item {
            background-color: #f9f9f9;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
        .total {
            font-size: 18px;
            font-weight: bold;
            text-align: right;
            margin-top: 20px;
        }
        .remove-btn {
            background-color: #f44336;
            color: white;
            padding: 5px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .remove-btn:hover {
            background-color: #d32f2f;
        }
        .slider-container {
            width: 100%;
            overflow-x: auto;
            white-space: nowrap;
            margin: 20px 0;
        }
        .slider-item {
            display: inline-block;
            margin-right: 20px;
            vertical-align: top;
        }
        .slider-item img {
            width: 200px;
            height: 200px;
            object-fit: cover;
        }
        .slider-caption {
            text-align: center;
            margin-top: 10px;
        }
        .message {
            padding: 10px 15px;
            margin: 10px 0;
            border-radius: 4px;
            font-weight: bold;
            display: none;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>傷心台北預購表單</h1>
        <!-- 衣服款式資訊 -->
        <h2>款式資訊</h2>
        <div class="slider-container">
            <div class="slider-item">
                <img src="./台ㄕ大_黑.png" alt="台ㄕ大 - 黑色">
                <div class="slider-caption">台ㄕ大 - 黑色</div>
            </div>
            <div class="slider-item">
                <img src="./台ㄕ大_白.png" alt="台ㄕ大 - 白色">
                <div class="slider-caption">台ㄕ大 - 白色</div>
            </div>
            <div class="slider-item">
                <img src="./台灣吃飯大學_舊款_白.png" alt="台灣吃飯大學 舊款 - 黑色">
                <div class="slider-caption">台灣吃飯大學 舊款 - 黑色</div>
            </div>
            <div class="slider-item">
                <img src="./台灣吃飯大學_舊款_白.png" alt="台灣吃飯大學 舊款 - 白色">
                <div class="slider-caption">台灣吃飯大學 舊款 - 白色</div>
            </div>
            <div class="slider-item">
                <img src="./台灣吃飯大學_舊款_白.png" alt="台灣吃飯大學 舊款 - 灰色">
                <div class="slider-caption">台灣吃飯大學 舊款 - 灰色</div>
            </div>
            <div class="slider-item">
                <img src="./台灣吃飯大學_新款_黑.png" alt="台灣吃飯大學 新款 - 黑色">
                <div class="slider-caption">台灣吃飯大學 新款 - 黑色</div>
            </div>
            <div class="slider-item">
                <img src="./台灣吃飯大學_新款_白.png" alt="台灣吃飯大學 新款 - 白色">
                <div class="slider-caption">台灣吃飯大學 新款 - 白色</div>
            </div>
            <div class="slider-item">
                <img src="./台灣吃飯大學_新款_白.png" alt="台灣吃飯大學 新款 - 灰色">
                <div class="slider-caption">台灣吃飯大學 新款 - 灰色</div>
            </div>
            <div class="slider-item">
                <img src="./台灣吃飯大學帆布袋.png" alt="台灣吃飯大學帆布袋 - 白色">
                <div class="slider-caption">台灣吃飯大學帆布袋 - 白色</div>
            </div>
            <div class="slider-item">
                <img src="./勝利的精子.png" alt="勝利的精子 - 白色">
                <div class="slider-caption">勝利的精子 - 白色</div>
            </div>
        </div>
        
        <table>
            <tr>
                <th>款式</th>
                <th>顏色</th>
                <th>尺寸</th>
                <th>價格</th>
            </tr>
            <tr>
                <td>台ㄕ大</td>
                <td>黑, 白</td>
                <td>S, M, L, XL, 2XL</td>
                <td>$450</td>
            </tr>
            <tr>
                <td>台灣吃飯大學 舊款</td>
                <td>黑, 白, 灰</td>
                <td>S, M, L, XL, 2XL</td>
                <td>$590</td>
            </tr>
            <tr>
                <td>台灣吃飯大學 新款</td>
                <td>黑, 白, 灰</td>
                <td>S, M, L, XL, 2XL</td>
                <td>$590</td>
            </tr>
            <tr>
                <td>台灣吃飯大學帆布袋</td>
                <td>白</td>
                <td>統一尺寸</td>
                <td>$250</td>
            </tr>
            <tr>
                <td>勝利的精子</td>
                <td>白</td>
                <td>S, M, L, XL, 2XL</td>
                <td>$550</td>
            </tr>
        </table>
        
        <!-- 個人資料 -->
        <h2>個人資料</h2>
        <form id="orderForm">
            <div class="form-group">
                <label for="name">姓名</label>
                <input type="text" id="name" name="name" required>
            </div>
            <div class="form-group">
                <label for="phone">電話</label>
                <input type="tel" id="phone" name="phone" required>
            </div>
            <div class="form-group">
                <label for="department">系級</label>
                <input type="text" id="department" name="department" required>
            </div>
            <div class="form-group">
                <label for="lineId">Line ID</label>
                <input type="text" id="lineId" name="lineId" required>
            </div>
            <div class="form-group">
                <label for="email">Email</label>
                <input type="email" id="email" name="email" required>
            </div>
            
            <!-- 添加訂單項目 -->
            <h2>添加商品</h2>
            <div class="form-group">
                <label for="style">款式</label>
                <select id="style" name="style" onchange="updateColorOptions()">
                    <option value="">請選擇款式</option>
                    <option value="台ㄕ大">台ㄕ大</option>
                    <option value="台灣吃飯大學 舊款">台灣吃飯大學 舊款</option>
                    <option value="台灣吃飯大學 新款">台灣吃飯大學 新款</option>
                    <option value="台灣吃飯大學帆布袋">台灣吃飯大學帆布袋</option>
                    <option value="勝利的精子">勝利的精子</option>
                </select>
            </div>
            <div class="form-group">
                <label for="color">顏色</label>
                <select id="color" name="color">
                    <option value="">請先選擇款式</option>
                </select>
            </div>
            <div class="form-group">
                <label for="size">尺寸</label>
                <select id="size" name="size">
                    <option value="">請先選擇款式</option>
                </select>
            </div>
            <div class="form-group">
                <label for="quantity">數量</label>
                <input type="number" id="quantity" name="quantity" min="1" value="1">
            </div>
            <div id="message" class="message"></div>
            <button type="button" onclick="addItem()">添加商品</button>
            
            <!-- 訂單項目 -->
            <h2>訂單項目</h2>
            <div id="orderItems"></div>
            
            <div class="total">總金額: <span id="totalAmount">$0</span></div>
            
            <div id="submitMessage" class="message" style="margin-bottom: 10px;"></div>
            <button type="button" onclick="submitOrder()">提交訂單</button>
        </form>
    </div>

    <script>
        // 定義商品資訊
        const products = {
            "台ㄕ大": {
                colors: ["黑", "白"],
                sizes: ["S", "M", "L", "XL", "2XL"],
                price: 450
            },
            "台灣吃飯大學 舊款": {
                colors: ["黑", "白", "灰"],
                sizes: ["S", "M", "L", "XL", "2XL"],
                price: 590
            },
            "台灣吃飯大學 新款": {
                colors: ["黑", "白", "灰"],
                sizes: ["S", "M", "L", "XL", "2XL"],
                price: 590
            },
            "台灣吃飯大學帆布袋": {
                colors: ["白"],
                sizes: ["統一尺寸"],
                price: 250
            },
            "勝利的精子": {
                colors: ["白"],
                sizes: ["S", "M", "L", "XL", "2XL"],
                price: 550
            }
        };
        
        let orderItems = [];
        let totalAmount = 0;
        
        // 更新顏色選項
        function updateColorOptions() {
            const styleSelect = document.getElementById("style");
            const colorSelect = document.getElementById("color");
            const sizeSelect = document.getElementById("size");
            
            // 清空現有選項
            colorSelect.innerHTML = '<option value="">請選擇顏色</option>';
            sizeSelect.innerHTML = '<option value="">請選擇尺寸</option>';
            
            const selectedStyle = styleSelect.value;
            
            if (selectedStyle && products[selectedStyle]) {
                // 添加對應的顏色選項
                products[selectedStyle].colors.forEach(color => {
                    const option = document.createElement("option");
                    option.value = color;
                    option.textContent = color;
                    colorSelect.appendChild(option);
                });
                
                // 添加對應的尺寸選項
                products[selectedStyle].sizes.forEach(size => {
                    const option = document.createElement("option");
                    option.value = size;
                    option.textContent = size;
                    sizeSelect.appendChild(option);
                });
            }
        }
        
        // 顯示訊息
        function showMessage(text, isSuccess = true) {
            const messageElement = document.getElementById("message");
            messageElement.textContent = text;
            messageElement.className = isSuccess ? "message success" : "message error";
            messageElement.style.display = "block";
            
            // 5秒後自動隱藏訊息
            setTimeout(() => {
                messageElement.style.display = "none";
            }, 5000);
        }
        
        // 顯示提交訊息
        function showSubmitMessage(text, isSuccess = true) {
            const messageElement = document.getElementById("submitMessage");
            messageElement.textContent = text;
            messageElement.className = isSuccess ? "message success" : "message error";
            messageElement.style.display = "block";
            
            // 如果是成功訊息，5秒後自動隱藏
            if (isSuccess) {
                setTimeout(() => {
                    messageElement.style.display = "none";
                }, 5000);
            }
        }
        
        // 添加訂單項目
        function addItem() {
            const style = document.getElementById("style").value;
            const color = document.getElementById("color").value;
            const size = document.getElementById("size").value;
            const quantity = parseInt(document.getElementById("quantity").value);
            
            if (!style || !color || !size || quantity < 1) {
                showMessage("請選擇完整的商品信息並確保數量大於0", false);
                return;
            }
            
            const price = products[style].price;
            const itemTotal = price * quantity;
            
            const item = {
                style,
                color,
                size,
                quantity,
                price,
                itemTotal
            };
            
            orderItems.push(item);
            renderOrderItems();
            updateTotalAmount();
            
            // 顯示成功訊息
            showMessage(`成功添加 ${quantity} 件 ${style} (${color}, ${size})`);
            
            // 清空表單以準備添加新商品
            document.getElementById("style").selectedIndex = 0;
            document.getElementById("color").innerHTML = '<option value="">請先選擇款式</option>';
            document.getElementById("size").innerHTML = '<option value="">請先選擇款式</option>';
            document.getElementById("quantity").value = 1;
        }
        
        // 渲染訂單項目
        function renderOrderItems() {
            const orderItemsContainer = document.getElementById("orderItems");
            orderItemsContainer.innerHTML = '';
            
            orderItems.forEach((item, index) => {
                const itemElement = document.createElement("div");
                itemElement.className = "order-item";
                itemElement.innerHTML = `
                    <p><strong>款式:</strong> ${item.style}</p>
                    <p><strong>顏色:</strong> ${item.color}</p>
                    <p><strong>尺寸:</strong> ${item.size}</p>
                    <p><strong>數量:</strong> ${item.quantity}</p>
                    <p><strong>單價:</strong> $${item.price}</p>
                    <p><strong>小計:</strong> $${item.itemTotal}</p>
                    <button type="button" class="remove-btn" onclick="removeItem(${index})">刪除</button>
                `;
                orderItemsContainer.appendChild(itemElement);
            });
        }
        
        // 移除訂單項目
        function removeItem(index) {
            const removedItem = orderItems[index];
            orderItems.splice(index, 1);
            renderOrderItems();
            updateTotalAmount();
            
            // 顯示刪除成功訊息
            showMessage(`已刪除 ${removedItem.style} (${removedItem.color}, ${removedItem.size})`);
        }
        
        // 更新總金額
        function updateTotalAmount() {
            totalAmount = orderItems.reduce((sum, item) => sum + item.itemTotal, 0);
            document.getElementById("totalAmount").textContent = `$${totalAmount}`;
        }
        
        // 清空表單函數
        function clearForm() {
            document.getElementById("name").value = '';
            document.getElementById("phone").value = '';
            document.getElementById("department").value = '';
            document.getElementById("lineId").value = '';
            document.getElementById("email").value = '';
            orderItems = [];
            renderOrderItems();
            updateTotalAmount();
        }
        
        // 提交訂單
        // 提交訂單
        // 提交訂單
        function submitOrder() {
            const orderForm = document.getElementById("orderForm");  // 改名為 orderForm
            const name = document.getElementById("name").value;
            const phone = document.getElementById("phone").value;
            const department = document.getElementById("department").value;
            const lineId = document.getElementById("lineId").value;
            const email = document.getElementById("email").value;
            
            if (!name || !phone || !department || !lineId || !email) {
                showSubmitMessage("請填寫完整的個人資料", false);
                return;
            }
            
            if (orderItems.length === 0) {
                showSubmitMessage("請至少添加一個訂單項目", false);
                return;
            }
            
            // 準備訂單資料
            const orderData = {
                personalInfo: {
                    name,
                    phone,
                    department,
                    lineId,
                    email
                },
                items: orderItems,
                totalAmount
            };
            
            // 顯示提交中訊息
            showSubmitMessage("正在提交訂單，請稍候...");
            
            // Google Apps Script URL
            const scriptURL = 'https://script.google.com/macros/s/AKfycbwlCOTALZLOw8JMEp-BoVrOHIxBfHdXcV_CKOMYGCp9O82esRN022469h9oqZirb---/exec';
            
            // 表單提交模式 - 這裡不再使用 const form
            const submitForm = document.createElement("form");  // 使用不同的變數名
            submitForm.setAttribute("method", "post");
            submitForm.setAttribute("action", scriptURL);
            submitForm.setAttribute("target", "_blank");
            
            // 創建隱藏的輸入字段，包含 JSON 數據
            const hiddenField = document.createElement("input");
            hiddenField.setAttribute("type", "hidden");
            hiddenField.setAttribute("name", "data");
            hiddenField.setAttribute("value", JSON.stringify(orderData));
            
            submitForm.appendChild(hiddenField);
            document.body.appendChild(submitForm);
            submitForm.submit();
            document.body.removeChild(submitForm);
            
            showSubmitMessage("訂單已提交，請在彈出視窗確認結果！");
        }
    </script>
</body>
</html>